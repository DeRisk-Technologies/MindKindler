(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4274],{10312:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>E});var r=a(95155),t=a(60796),l=a(3998),i=a(87270),d=a(86948),n=a(90109),c=a(32265),o=a(27314),m=a(97776),u=a(92033),x=a(14294);let f=(0,x.A)("KeyRound",[["path",{d:"M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z",key:"1s6t7t"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]]);var h=a(74640),p=a(13630);let j=(0,x.A)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);var g=a(11647),y=a(51834),v=a(76444),b=a(65142),N=a(11186),w=a(12115),A=a(15894),C=a(19708),k=a(14585),R=a(59253),U=a(31120),S=a(13406);let T=["Admin","EducationalPsychologist","Teacher","Parent","Student","SchoolAdministrator","LocalEducationAuthority","ClinicalPsychologist","TrainingDesigner","HR"];function E(){var e,s,a,x,E,L;let{data:P,loading:F}=(0,t.$l)("users","createdAt","desc"),{data:J}=(0,t.$l)("departments","name","asc"),[q,V]=(0,w.useState)(!1),[$,_]=(0,w.useState)(!1),[z,M]=(0,w.useState)(!1),[D,H]=(0,w.useState)(null),[I,O]=(0,w.useState)(""),[B,X]=(0,w.useState)(null),{toast:Z}=(0,A.dj)(),G=P.filter(e=>{var s,a,r;return(null==(s=e.displayName)?void 0:s.toLowerCase().includes(I.toLowerCase()))||(null==(a=e.email)?void 0:a.toLowerCase().includes(I.toLowerCase()))||(null==(r=e.role)?void 0:r.toLowerCase().includes(I.toLowerCase()))}),W=async e=>{e.preventDefault(),M(!0);let s=new FormData(e.currentTarget),a={displayName:s.get("name"),email:s.get("email"),role:s.get("role"),departmentId:s.get("departmentId"),phone:s.get("phone"),address:s.get("address"),updatedAt:(0,C.O5)()};try{D?(await (0,C.mZ)((0,C.H9)(k.db,"users",D),a),Z({title:"User Updated",description:"Profile details saved."})):(await (0,C.gS)((0,C.rJ)(k.db,"users"),{...a,uid:"generated_by_admin_"+Math.random().toString(36),createdAt:new Date().toISOString()}),Z({title:"User Added",description:"User record created in database."})),V(!1),H(null)}catch(e){Z({title:"Error",description:e.message,variant:"destructive"})}finally{M(!1)}},K=async()=>{if(null==B?void 0:B.email){M(!0);try{await (0,R.J1)(k.j2,B.email),Z({title:"Email Sent",description:"Password reset link sent to ".concat(B.email,".")}),_(!1)}catch(e){Z({title:"Error",description:e.message,variant:"destructive"})}finally{M(!1)}}},Y=async e=>{if(confirm("Are you sure? This removes the profile from the database."))try{await (0,C.kd)((0,C.H9)(k.db,"users",e)),Z({title:"Deleted",description:"User removed."})}catch(e){Z({title:"Error",variant:"destructive",description:e.message})}};return(0,r.jsxs)("div",{className:"space-y-8",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold tracking-tight text-primary",children:"User Management"}),(0,r.jsx)("p",{className:"text-muted-foreground",children:"Administer users, roles, departments, and permissions."})]}),(0,r.jsxs)(d.Zp,{children:[(0,r.jsx)(d.aR,{children:(0,r.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[(0,r.jsxs)("div",{className:"relative w-full md:w-96",children:[(0,r.jsx)(n.A,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),(0,r.jsx)(b.p,{placeholder:"Search users...",className:"pl-8",value:I,onChange:e=>O(e.target.value)})]}),(0,r.jsxs)(y.lG,{open:q,onOpenChange:e=>{V(e),e||H(null)},children:[(0,r.jsx)(y.zM,{asChild:!0,children:(0,r.jsxs)(l.$,{children:[(0,r.jsx)(c.A,{className:"mr-2 h-4 w-4"})," Add User"]})}),(0,r.jsxs)(y.Cf,{className:"max-w-2xl",children:[(0,r.jsxs)(y.c7,{children:[(0,r.jsx)(y.L3,{children:D?"Edit User Profile":"Add New User"}),(0,r.jsx)(y.rr,{children:"Manage comprehensive user details."})]}),(0,r.jsxs)("form",{onSubmit:W,className:"space-y-4",children:[(0,r.jsxs)(S.tU,{defaultValue:"account",className:"w-full",children:[(0,r.jsxs)(S.j7,{className:"grid w-full grid-cols-2",children:[(0,r.jsx)(S.Xi,{value:"account",children:"Account & Role"}),(0,r.jsx)(S.Xi,{value:"profile",children:"Personal Profile"})]}),(0,r.jsxs)(S.av,{value:"account",className:"space-y-4 pt-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(v.J,{htmlFor:"name",children:"Full Name"}),(0,r.jsx)(b.p,{id:"name",name:"name",required:!0,defaultValue:D?null==(e=P.find(e=>e.id===D))?void 0:e.displayName:""})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(v.J,{htmlFor:"email",children:"Email"}),(0,r.jsx)(b.p,{id:"email",name:"email",type:"email",required:!0,defaultValue:D?null==(s=P.find(e=>e.id===D))?void 0:s.email:""})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(v.J,{children:"Role"}),(0,r.jsxs)(N.l6,{name:"role",defaultValue:D?null==(a=P.find(e=>e.id===D))?void 0:a.role:"teacher",children:[(0,r.jsx)(N.bq,{children:(0,r.jsx)(N.yv,{})}),(0,r.jsx)(N.gC,{children:T.map(e=>(0,r.jsx)(N.eb,{value:e.toLowerCase(),children:e.replace(/([A-Z])/g," $1")},e))})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(v.J,{children:"Department"}),(0,r.jsxs)(N.l6,{name:"departmentId",defaultValue:D?null==(x=P.find(e=>e.id===D))?void 0:x.departmentId:"none",children:[(0,r.jsx)(N.bq,{children:(0,r.jsx)(N.yv,{placeholder:"Select Department"})}),(0,r.jsxs)(N.gC,{children:[(0,r.jsx)(N.eb,{value:"none",children:"None"}),J.map(e=>(0,r.jsx)(N.eb,{value:e.id,children:e.name},e.id))]})]})]})]})]}),(0,r.jsxs)(S.av,{value:"profile",className:"space-y-4 pt-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4 mb-2",children:[(0,r.jsx)("div",{className:"h-20 w-20 rounded-full bg-muted flex items-center justify-center border-2 border-dashed",children:(0,r.jsx)(o.A,{className:"h-8 w-8 text-muted-foreground"})}),(0,r.jsx)(l.$,{size:"sm",variant:"secondary",type:"button",children:"Upload Photo"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(v.J,{htmlFor:"phone",children:"Phone Number"}),(0,r.jsx)(b.p,{id:"phone",name:"phone",type:"tel",defaultValue:D?null==(E=P.find(e=>e.id===D))?void 0:E.phone:""})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(v.J,{htmlFor:"address",children:"Address"}),(0,r.jsx)(U.T,{id:"address",name:"address",defaultValue:D?null==(L=P.find(e=>e.id===D))?void 0:L.address:""})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(v.J,{children:"Documents"}),(0,r.jsxs)("div",{className:"border-2 border-dashed rounded p-4 text-center text-sm text-muted-foreground cursor-pointer hover:bg-muted/50",children:[(0,r.jsx)(m.A,{className:"h-6 w-6 mx-auto mb-1"}),"Upload CV / Certificates"]})]})]})]}),(0,r.jsx)(y.Es,{children:(0,r.jsxs)(l.$,{type:"submit",disabled:z,children:[z&&(0,r.jsx)(u.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Save Changes"]})})]})]})]})]})}),(0,r.jsx)(d.Wu,{children:F?(0,r.jsx)("div",{className:"flex justify-center py-8",children:(0,r.jsx)(u.A,{className:"h-8 w-8 animate-spin text-primary"})}):(0,r.jsxs)(i.XI,{children:[(0,r.jsx)(i.A0,{children:(0,r.jsxs)(i.Hj,{children:[(0,r.jsx)(i.nd,{children:"Name"}),(0,r.jsx)(i.nd,{children:"Role"}),(0,r.jsx)(i.nd,{children:"Department"}),(0,r.jsx)(i.nd,{children:"Email"}),(0,r.jsx)(i.nd,{className:"text-right",children:"Actions"})]})}),(0,r.jsx)(i.BF,{children:G.map(e=>{var s,a;return(0,r.jsxs)(i.Hj,{children:[(0,r.jsx)(i.nA,{className:"font-medium",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("div",{className:"h-8 w-8 rounded-full bg-primary/10 flex items-center justify-center text-xs font-bold text-primary",children:e.displayName?e.displayName.substring(0,2).toUpperCase():"U"}),e.displayName||"N/A"]})}),(0,r.jsx)(i.nA,{children:(0,r.jsx)(g.E,{variant:"outline",className:"capitalize",children:e.role})}),(0,r.jsx)(i.nA,{children:(s=e.departmentId,(null==(a=J.find(e=>e.id===s))?void 0:a.name)||"-")}),(0,r.jsx)(i.nA,{children:e.email}),(0,r.jsx)(i.nA,{className:"text-right",children:(0,r.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,r.jsx)(l.$,{variant:"ghost",size:"icon",onClick:()=>{X(e),_(!0)},children:(0,r.jsx)(f,{className:"h-4 w-4 text-orange-500"})}),(0,r.jsx)(l.$,{variant:"ghost",size:"icon",onClick:()=>{H(e.id),V(!0)},children:(0,r.jsx)(h.A,{className:"h-4 w-4"})}),(0,r.jsx)(l.$,{variant:"ghost",size:"icon",onClick:()=>Y(e.id),children:(0,r.jsx)(p.A,{className:"h-4 w-4 text-destructive"})})]})})]},e.id)})})]})})]}),(0,r.jsx)(y.lG,{open:$,onOpenChange:_,children:(0,r.jsxs)(y.Cf,{children:[(0,r.jsxs)(y.c7,{children:[(0,r.jsx)(y.L3,{children:"Reset Password"}),(0,r.jsxs)(y.rr,{children:["Send a password reset email to ",(0,r.jsx)("b",{children:null==B?void 0:B.email}),"."]})]}),(0,r.jsx)("div",{className:"py-4 text-sm text-muted-foreground",children:(0,r.jsx)("p",{children:"For security reasons, administrators cannot set passwords directly. This action will send an automated email to the user with a link to choose a new password securely."})}),(0,r.jsxs)(y.Es,{children:[(0,r.jsx)(l.$,{variant:"outline",onClick:()=>_(!1),children:"Cancel"}),(0,r.jsxs)(l.$,{onClick:K,disabled:z,children:[z&&(0,r.jsx)(u.A,{className:"mr-2 h-4 w-4 animate-spin"}),(0,r.jsx)(j,{className:"mr-2 h-4 w-4"}),"Send Reset Link"]})]})]})})]})}},11186:(e,s,a)=>{"use strict";a.d(s,{bq:()=>u,eb:()=>p,gC:()=>h,l6:()=>o,yv:()=>m});var r=a(95155),t=a(12115),l=a(95102),i=a(59007),d=a(42614),n=a(72251),c=a(64269);let o=l.bL;l.YJ;let m=l.WT,u=t.forwardRef((e,s)=>{let{className:a,children:t,...d}=e;return(0,r.jsxs)(l.l9,{ref:s,className:(0,c.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",a),...d,children:[t,(0,r.jsx)(l.In,{asChild:!0,children:(0,r.jsx)(i.A,{className:"h-4 w-4 opacity-50"})})]})});u.displayName=l.l9.displayName;let x=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)(l.PP,{ref:s,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",a),...t,children:(0,r.jsx)(d.A,{className:"h-4 w-4"})})});x.displayName=l.PP.displayName;let f=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)(l.wn,{ref:s,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",a),...t,children:(0,r.jsx)(i.A,{className:"h-4 w-4"})})});f.displayName=l.wn.displayName;let h=t.forwardRef((e,s)=>{let{className:a,children:t,position:i="popper",...d}=e;return(0,r.jsx)(l.ZL,{children:(0,r.jsxs)(l.UC,{ref:s,className:(0,c.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===i&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:i,...d,children:[(0,r.jsx)(x,{}),(0,r.jsx)(l.LM,{className:(0,c.cn)("p-1","popper"===i&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),(0,r.jsx)(f,{})]})})});h.displayName=l.UC.displayName,t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)(l.JU,{ref:s,className:(0,c.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",a),...t})}).displayName=l.JU.displayName;let p=t.forwardRef((e,s)=>{let{className:a,children:t,...i}=e;return(0,r.jsxs)(l.q7,{ref:s,className:(0,c.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...i,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(l.VF,{children:(0,r.jsx)(n.A,{className:"h-4 w-4"})})}),(0,r.jsx)(l.p4,{children:t})]})});p.displayName=l.q7.displayName,t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)(l.wv,{ref:s,className:(0,c.cn)("-mx-1 my-1 h-px bg-muted",a),...t})}).displayName=l.wv.displayName},11647:(e,s,a)=>{"use strict";a.d(s,{E:()=>d});var r=a(95155);a(12115);var t=a(83101),l=a(64269);let i=(0,t.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function d(e){let{className:s,variant:a,...t}=e;return(0,r.jsx)("div",{className:(0,l.cn)(i({variant:a}),s),...t})}},13406:(e,s,a)=>{"use strict";a.d(s,{Xi:()=>c,av:()=>o,j7:()=>n,tU:()=>d});var r=a(95155),t=a(12115),l=a(25667),i=a(64269);let d=l.bL,n=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)(l.B8,{ref:s,className:(0,i.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",a),...t})});n.displayName=l.B8.displayName;let c=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)(l.l9,{ref:s,className:(0,i.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",a),...t})});c.displayName=l.l9.displayName;let o=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)(l.UC,{ref:s,className:(0,i.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a),...t})});o.displayName=l.UC.displayName},27314:(e,s,a)=>{"use strict";a.d(s,{A:()=>r});let r=(0,a(14294).A)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},31120:(e,s,a)=>{"use strict";a.d(s,{T:()=>i});var r=a(95155),t=a(12115),l=a(64269);let i=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("textarea",{className:(0,l.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:s,...t})});i.displayName="Textarea"},87270:(e,s,a)=>{"use strict";a.d(s,{A0:()=>d,BF:()=>n,Hj:()=>c,XI:()=>i,nA:()=>m,nd:()=>o});var r=a(95155),t=a(12115),l=a(64269);let i=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("div",{className:"relative w-full overflow-auto",children:(0,r.jsx)("table",{ref:s,className:(0,l.cn)("w-full caption-bottom text-sm",a),...t})})});i.displayName="Table";let d=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("thead",{ref:s,className:(0,l.cn)("[&_tr]:border-b",a),...t})});d.displayName="TableHeader";let n=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("tbody",{ref:s,className:(0,l.cn)("[&_tr:last-child]:border-0",a),...t})});n.displayName="TableBody",t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("tfoot",{ref:s,className:(0,l.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",a),...t})}).displayName="TableFooter";let c=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("tr",{ref:s,className:(0,l.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",a),...t})});c.displayName="TableRow";let o=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("th",{ref:s,className:(0,l.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",a),...t})});o.displayName="TableHead";let m=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("td",{ref:s,className:(0,l.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",a),...t})});m.displayName="TableCell",t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("caption",{ref:s,className:(0,l.cn)("mt-4 text-sm text-muted-foreground",a),...t})}).displayName="TableCaption"},90109:(e,s,a)=>{"use strict";a.d(s,{A:()=>r});let r=(0,a(14294).A)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},97776:(e,s,a)=>{"use strict";a.d(s,{A:()=>r});let r=(0,a(14294).A)("CloudUpload",[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]])},98305:(e,s,a)=>{Promise.resolve().then(a.bind(a,10312))}},e=>{e.O(0,[2992,3644,3286,5936,9820,1329,9295,7819,85,5667,4098,8441,1255,7358],()=>e(e.s=98305)),_N_E=e.O()}]);